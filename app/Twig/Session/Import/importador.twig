{% extends 'templateBase.twig' %}
{% block css %}
	{{parent()}}
	<link href="/assets/css/importa-grade.css?version={{versionScripts}}" rel="stylesheet">
{% endblock %}
{% block content %}
	<div class="pagetitle">
		<h1>Sessão</h1>
		<nav>
			<ol class="breadcrumb">
				<li class="breadcrumb-item">
					<a href="#">Importação de grade</a>
				</li>
				<li class="breadcrumb-item">
					<a href="#">{{tituloImportacao}}</a>
				</li>
			</ol>
		</nav>
	</div>
	{% if sessionToImport %}
		<div class='p-3 bg-secondary text-light d-flex justify-content-between align-items-center'>
			<div>
				<span id='count-registros'>{{is_array(sessionToImport.buyInList)?count(sessionToImport.buyInList):0}}</span>
				registro(s) para importar
			</div>
			<button data-session-id="{{sessionToImport.id}}" id='btn-importar' class='btn btn-success'>Importar</button>
		</div>
		{% if sessionToImport.buyInList and count(sessionToImport.buyInList) %}
			{% for bi in sessionToImport.buyInList %}
				{% set classLucro = bi['isClosed'] ?  (bi['profit'] > 0 ? 'text-success' : ((bi['profit'] < 0) ? 'text-danger' : '')) : '' %}
				{% set startDate = ci_time(bi['startDate']) %}
				{% set endDate = ci_time(bi['endDate']) %}
				{% if (bi['isClosed']) %}
					{% set cardTime = box_bi('Encerrado',startDate.format('d/m/Y H:i') , "title='" ~ endDate.humanize() ~ "' class='col-lg-3 col-md-6 col-xs-6 col-6'") %}
				{% else %}
					{% set cardTime = box_bi('Início',startDate.format('d/m/Y H:i') , "title='" ~  startDate.humanize()~ "' class='col-lg-3 col-md-6 col-xs-6 col-6'") %}
				{% endif %}
				<div class="card mb-1 p-2 buyin-to-import" data-codigo-bi="{{bi.buyinId}}" id="card_{{bi.buyinId}}">
					<div class="row g-0">
						<div class='d-flex align-items-center row px-0 mx-0'>
							<div class="p-0 col-lg-2 col-md-2 col-sm-2 col-xs-3 col-3 px-1 py-0 d-flex align-content-center align-items-center">
								<img src="{{(getSiteSrcImage(bi['pokerSiteName'])) }}" style="max-width:50px;" class="img-fluid rounded-circle" alt="{{bi['pokerSiteShortName']}}">
							</div>

							<div class="p-0 col-lg-6 col-sm-6 col-xs-9 col-9">
								<h5 class='card-title  {{classLucro}}'>
									{% if bi['position'] =='1' %}
										<i class="bx bxs-trophy"></i>
									{% endif %}
									{{ bi['gameName']}}<span>
										{{bi['pokerSiteName'] }}</span>
								</h5>
							</div>
							<div class="p-0 px-0 col-lg-4 col-md-4 col-sm-4 col-xs-12 col-12 div-remove-import">
								<button class='btn btn-danger w-100 btn-remove-import' onclick="removeBuyIn({{bi.buyinId}});">Remover da importação</button>
							</div>
						</div>
						<div class="col-lg-12 col-sm-12 col-xs-12 col-12 pt-0">
							<div class="card-body bg-light py-0">
								<div class='row text-muted small '>
									{{box_bi('Total buy in', dolarFormat(bi['totalBuyIn']), 'class="col-lg-3 col-md-6 col-sm-6  col-xs-6 col-6"') }}
									{{box_bi('Total prize', dolarFormat(bi['totalPrize']), 'class="col-lg-3 col-md-6 col-sm-6 col-xs-6 col-6"')}}
									{{box_bi('Lucro', dolarFormat(bi['profit']), "class='col-lg-3 col-md-3 col-xs-6 col-6 classLucro'")}}
									{{cardTime}}
								</div>
							</div>
						</div>
						<!--accordion -->
						<div class="accordion accordion-flush" id="accordion{{bi['buyinId']}}">
							<div class="accordion-item">
								<h2 class="accordion-header" id="flush-heading{{bi['buyinId']}}">
									<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapse{{bi['buyinId']}}" aria-expanded="false" aria-controls="flush-collapse{{bi['buyinId']}}">
										Mais detalhes
									</button>
								</h2>
								<div id="flush-collapse{{bi['buyinId']}}" class="accordion-collapse collapse" aria-labelledby="flush-heading{{bi['buyinId']}}" data-bs-parent="#accordion{{bi['buyinId']}}">
									<div class="accordion-body">
										<hr class='divider'/>
										{% if (bi['stakingSold'] > 0) %}
											<div class='row p-3'>
												{{box_bi('Cota oferecida', percent(bi['stakingSelling']), 'class="col-md-4 col-lg-4 col-xs-4 col-4"') }}
												{{box_bi('Markup', (bi['markup']), 'class="col-md-4 col-lg-4 col-xs-4 col-4"')  }}
												{{box_bi('Cota vendida', percent(bi['stakingSold']), 'class="col-md-4 col-lg-4 col-xs-4 col-4 "')  }}
												{{box_bi('Patrocinadores pagaram', dolarFormat(bi['stakingReturn']), 'class="col-md-4 col-lg-4 col-xs-6 col-4"')  }}
												{{box_bi('Patrocinadores receberam', dolarFormat(bi['totalPrizeStakers']), 'class="col-md-4 col-lg-4 col-xs-4 col-4"')  }}
											</div>
										{% endif %}
										<div class='row p-3'>
											{{box_bi('Buy in inicial', dolarFormat(bi['buyInValue']), 'class="col-lg-6 col-md-6 col-sm-6  col-xs-6 col-6"') }}
											{{box_bi('Buy in reentrada', dolarFormat(bi['reentryBuyIn']), 'class="col-md-6 col-md-6  col-xs-6 col-6 "')  }}
											{% if bi['isClosed'] %}
												{{box_bi('Prêmio reentrada', dolarFormat(bi['prizeReentry']), 'class="col-md-4 col-xs-4 col-4 "')  }}
												{{box_bi('Tamanho do field', (bi['fieldSize']), 'class="col-md-4 col-xs-4 col-4 "') }}
												{{box_bi('Posição final', (bi['position'])?(bi['position'] ~ 'º'):'Não informado', 'class="col-md-4 col-xs-4 col-4 "')  }}
											{% endif %}
										</div>
										<hr class='divider'/>
									</div>
								</div>
							</div>
						</div>
						<!--end accordion -->
					</div>
				</div>
			{% endfor %}
		{% endif %}
	{% else %}
		<div>A sessão para importação não foi encontrada.</div>
	{% endif %}
{% endblock %}
{% block scriptsFooter %}
	{{parent()}}
	<script src='\assets\scripts\importacao.js'></script>
{% endblock %}
